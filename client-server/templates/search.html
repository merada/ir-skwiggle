{% extends "layout.html" %}
{% block title %}Search{% endblock %}

{% block content %}
  {% if query and response %}
  <div class="container col-lg-2">
    <form class="form-horizontal" action="{{ url_for('search') }}">
      <div class="form-group">
        <label for="select" class="col-lg-2 control-label"></label>
        <div class="col-lg-10">
          {% for facetfield in response.facet_counts['facet_fields'] %}
            {% for element in response.facet_counts['facet_fields'][facetfield] %}
              {% if response.facet_counts['facet_fields'][facetfield][element] > 0 %}
                {{ facetfield }}
                <select class="form-control" id="select" padding="10px">
                {% break %}
              {% endif %}
            {% endfor %}
            <option>All</option>
            {% for element in response.facet_counts['facet_fields'][facetfield] %}
              {% if response.facet_counts['facet_fields'][facetfield][element] > 0 %}
                <option>{{ element }} ({{response.facet_counts['facet_fields'][facetfield][element]}})</option>
              {% endif %}
            {% endfor %}
            </select>
            {% for element in response.facet_counts['facet_fields'][facetfield] %}
              {% if response.facet_counts['facet_fields'][facetfield][element] > 0 %}
                <br>
                {% break %}
              {% endif %}
            {% endfor %}
          {% endfor %}
        </div>
      </div>
      <div class="form-group">
        <button class="btn btn-default" margin-left="23px">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>
  {% endif %}

  <div class="container col-lg-9">
    {% if spellchecks %}
      {% if not spellchecks.spellcheck['suggestions']['correctlySpelled'] %}
        <a class="text-info">Did you mean:</a>
        <a href="{{ url_for('search') }}?query={{ spellchecks.spellcheck['suggestions']['collation']['collationQuery'] }}">
          {{ spellchecks.spellcheck['suggestions']['collation']['collationQuery'] }}
        </a>
      {% endif %}
    {% endif %}

    {% if response %}
      {% for result in response %}
      <blockquote>
        {% if result.identifier %}
          <h4>
            <a href="{{ result.identifier[0] }}">{{ result.title[0][:50] }}
              {% if result.title[0][50:51] %}...{% endif %}</a>
          </h4>
        {% else %}
          <h4><p class="text-primary">{{ result.title[0][:50] }}...</p></h4>
        {% endif %}

        <h6>

        {% if result.creator %}
          {{ result.creator[0] }}
        {% else %}
          <h5>Unknown creator</h5>
        {% endif %}

        {% if result.description %}
          <div class="field"> {{ result.description[0][:300] }} </div>
        {% else %}
          <div class="field"> No description found. </div>
        {% endif %}
        
        {% if result.identifier %}
          <div class="field"> <a class="text-success" href="{{ result.identifier[0] }}">{{ result.identifier[0] }}</a> </div>
        {% else %}
          <div class="field"> <p class="text-success"> No identifier found. </p></div>
        {% endif %}

        </h6>

      </blockquote>

      {% else %}
        <h3>No results found.</h3>        
      {% endfor %}

      {{ pagination.links|safe }}
    {% elif query %}
      <div class="col-lg-1"><!-- blank for spacing --></div>
      <div class="col-lg-6"><h4>No results found.</h4></div>
    {% else %}
      <div class="col-lg-1"><!-- blank for spacing --></div>
      <div class="col-lg-6"><h4>Here be no query ...</h4></div>
    {% endif %}
  </div>
{% endblock %}
